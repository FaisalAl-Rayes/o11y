rule_files:
  - prometheus.image_controller_alerts.yaml

evaluation_interval: 1m

tests:
  - interval: 1m
    input_series:
      - series: konflux_up{service="quay", check="image-controller", source_cluster="prod"}
        values: '1x60 _x10 1x5'

    alert_rule_test:
      - eval_time: 66m
        alertname: QuayFailureAlert
      - eval_time: 67m
        alertname: QuayFailureAlert
        exp_alerts:
          - exp_labels:
              severity: warning
              check: image-controller
              service: quay
              source_cluster: prod
            exp_annotations:
              summary: Availability metric 'konflux_up' is missing for quay in image-controller.
              description: >-
                The 'konflux_up' availability metric is missing for quay in image-controller on cluster prod indicating a possible service disruption.
              team: build
              alert_team_handle: <!subteam^S03DM1RL0TF>
              runbook_url: https://gitlab.cee.redhat.com/konflux/docs/sop/-/blob/main/image-controller/availability_quay.md
      - eval_time: 75m
        alertname: QuayFailureAlert
